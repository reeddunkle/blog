<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Using Sass to automatically pick text colors</title>
  <meta name="description" content="Theming is always a challenge, particularly when you’re working on a library, rather than a standalone website. One example of an interesting issue that you’...">

    <!--
      Hello, and welcome to the source for my site!
      There's not a lot to see around here, but I hope you get some inspiration/ideas/laughs.

      Here's an ASCII art stick figure saying hi:  o/
                                                  /|
                                                  / \
    -->

  <link rel="canonical" href="https://sgom.es/2016/12/21/using-sass-to-automatically-pick-text-colors.html">
  <link rel="alternate" type="application/rss+xml" title="sgom.es" href="/feed.xml">

  <link rel="manifest" href="/manifest.json">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="sgom.es">
  <link rel="icon" sizes="16x16" href="/assets/images/touch/16x16.png">
  <link rel="icon" sizes="32x32" href="/assets/images/touch/32x32.png">
  <link rel="icon" sizes="192x192" href="/assets/images/touch/192x192.png">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="sgom.es">
  <link rel="apple-touch-icon" href="/assets/images/touch/152x152.png">

  <meta name="msapplication-TileImage" content="/assets/images/touch/144x144.png">
  <meta name="msapplication-TileColor" content="#009688">

  <meta name="theme-color" content="#009688">

  <style>
  @font-face{font-display:fallback;font-family:'Roboto';font-style:normal;font-weight:400;src:local("Roboto"),local("Roboto-Regular"),url(/assets/fonts/oMMgfZMQthOryQo9n22dcuvvDin1pK8aKteLpeZ5c0A.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215}@font-face{font-display:fallback;font-family:'Roboto';font-style:normal;font-weight:500;src:local("Roboto Medium"),local("Roboto-Medium"),url(/assets/fonts/RxZJdnzeo3R5zSexge8UUZBw1xU1rKptJj_0jans920.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215}@font-face{font-display:fallback;font-family:'Roboto';font-style:normal;font-weight:700;src:local("Roboto Bold"),local("Roboto-Bold"),url(/assets/fonts/d-6IYplOFocCacKzxwXSOJBw1xU1rKptJj_0jans920.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215}@font-face{font-display:fallback;font-family:'Roboto';font-style:italic;font-weight:400;src:local("Roboto Italic"),local("Roboto-Italic"),url(/assets/fonts/vPcynSL0qHq_6dX7lKVByXYhjbSpvc47ee6xR_80Hnw.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215}@font-face{font-display:fallback;font-family:'Roboto';font-style:italic;font-weight:500;src:local("Roboto Medium Italic"),local("Roboto-MediumItalic"),url(/assets/fonts/OLffGBTaF0XFOW1gnuHF0Ygp9Q8gbYrhqGlRav_IXfk.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215}@font-face{font-family:'Roboto Mono';font-style:normal;font-weight:400;src:local("Roboto Mono"),local("RobotoMono-Regular"),url(/assets/fonts/hMqPNLsu_dywMa4C_DEpY4gp9Q8gbYrhqGlRav_IXfk.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215}.mdc-button{font-family:Roboto,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-size:.875rem;letter-spacing:.04em;line-height:1.5rem;color:rgba(0,0,0,.87);color:var(--mdc-theme-text-primary-on-light,rgba(0,0,0,.87));display:inline-block;position:relative;min-width:64px;height:36px;padding:0 16px;border:none;border-radius:2px;outline:none;background:0 0;font-size:14px;font-weight:500;line-height:36px;text-align:center;text-transform:uppercase;vertical-align:middle;box-sizing:border-box;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.mdc-button--theme-dark,.mdc-theme--dark .mdc-button{color:#fff;color:var(--mdc-theme-text-primary-on-dark,#fff)}.mdc-button::before{position:absolute;top:0;left:0;width:100%;height:100%;transition:opacity 120ms 0ms cubic-bezier(.4,0,1,1);border-radius:inherit;background:currentColor;content:"";opacity:0}.mdc-button:focus::before{transition:opacity 120ms 0ms cubic-bezier(0,0,.2,1);opacity:.12}.mdc-button:active::before{transition:opacity 120ms 0ms cubic-bezier(0,0,.2,1);opacity:.18}.mdc-button:focus:active::before{transition-timing-function:cubic-bezier(.4,0,.2,1)}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button--dense{height:32px;font-size:.8125rem;line-height:32px}.mdc-button--raised{box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);transition:box-shadow 280ms cubic-bezier(.4,0,.2,1);will-change:box-shadow;min-width:88px}.mdc-button--raised:active{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.mdc-button--theme-dark .mdc-button--raised,.mdc-theme--dark .mdc-button--raised{background-color:#009688;background-color:var(--mdc-theme-primary,#009688)}.mdc-button--accent.mdc-button--raised::before,.mdc-button--primary.mdc-button--raised::before,.mdc-button--theme-dark .mdc-button--raised::before,.mdc-theme--dark .mdc-button--raised::before{color:#000}.mdc-button--primary,.mdc-button--theme-dark .mdc-button--primary,.mdc-theme--dark .mdc-button--primary{color:#009688;color:var(--mdc-theme-primary,#009688)}.mdc-button--primary.mdc-button--raised{background-color:#009688;background-color:var(--mdc-theme-primary,#009688);color:#fff;color:var(--mdc-theme-text-primary-on-primary,#fff)}.mdc-button--accent,.mdc-button--theme-dark .mdc-button--accent,.mdc-theme--dark .mdc-button--accent{color:#ffab40;color:var(--mdc-theme-accent,#ffab40)}.mdc-button--accent.mdc-button--raised{background-color:#ffab40;background-color:var(--mdc-theme-accent,#ffab40);color:rgba(0,0,0,.87);color:var(--mdc-theme-text-primary-on-accent,rgba(0,0,0,.87))}.mdc-button--compact{padding:0 8px}.mdc-button:disabled,fieldset:disabled .mdc-button{color:rgba(0,0,0,.26);cursor:default;pointer-events:none}.mdc-button--theme-dark .mdc-button:disabled,.mdc-button--theme-dark fieldset:disabled .mdc-button,.mdc-theme--dark .mdc-button:disabled,.mdc-theme--dark fieldset:disabled .mdc-button{color:rgba(255,255,255,.3)}.mdc-button--raised:disabled,fieldset:disabled .mdc-button--raised{box-shadow:0 0 0 0 rgba(0,0,0,.2),0 0 0 0 rgba(0,0,0,.14),0 0 0 0 rgba(0,0,0,.12);background-color:rgba(0,0,0,.12);pointer-events:none}.mdc-button--theme-dark .mdc-button--raised:disabled,.mdc-button--theme-dark fieldset:disabled .mdc-button--raised,.mdc-theme--dark .mdc-button--raised:disabled,.mdc-theme--dark fieldset:disabled .mdc-button--raised{background-color:rgba(255,255,255,.12)}.header{display:flex;height:80px;background:#009688;color:#fff;justify-content:center;align-items:center;flex-shrink:0;z-index:2;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.header-title{text-decoration:none;color:#fff;font-family:Roboto,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-size:2.125rem;letter-spacing:normal;line-height:2.5rem;margin:-.5rem 0 4rem -.07em;font-weight:700}.header-title:hover,.header-title:visited{color:#fff}.post{background:#fff;padding:48px 24px;margin:0 auto;color:rgba(0,0,0,.87);width:100%;max-width:45rem;box-sizing:border-box}.post-meta,.post-title{display:block;color:#009688;font-family:Roboto,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}.post-title{margin:-.5rem 0 1rem -.06em;font-size:1.5rem;letter-spacing:normal;line-height:2rem;font-weight:700;margin-bottom:0}.post-meta{font-size:.875rem;font-weight:500;letter-spacing:.04em;line-height:1.5rem;margin-bottom:16px}.post-tags{display:inline-block;flex-grow:1;font-family:'Roboto Mono',monospace;letter-spacing:normal}.post-image{display:block;max-width:100%;margin:0 auto}.post-content{line-height:1.25rem;font-size:1rem}.post-content,.post-content h1,.post-content pre{font-weight:400;letter-spacing:normal}.post-content h1{line-height:2rem;font-size:1.5rem}.post-content h2{font-size:1.25rem;font-weight:500;letter-spacing:.02em;line-height:2rem}.post-content h3{font-size:.938rem;font-weight:400;letter-spacing:.04em;line-height:1.5rem}.post-content h4,.post-content strong{font-weight:500;line-height:1.5rem;font-size:1rem;letter-spacing:normal}.post-content a,.post-content a:hover,.post-content a:visited{color:#00bfa5}.post-content pre{border-radius:2px;padding:8px;font-size:.9375rem;font-style:normal;line-height:normal;font-family:'Roboto Mono',monospace;overflow-x:auto}.post-content code{color:#0d47a1;font-family:'Roboto Mono',monospace}.post-content figure{max-width:100%;box-sizing:border-box}.post-content,.post-content figcaption,.post-content h1,.post-content h2,.post-content h3,.post-content h4,.post-content strong,body,html{font-family:Roboto,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}.post-content figcaption{text-align:center;font-size:.75rem;font-weight:400;letter-spacing:.08em;line-height:1.25rem}.home,.home-post-list,body,html{padding:24px 0;box-sizing:border-box}.home-post-list{list-style:none;padding:0 8px;margin:0 auto;width:100%;max-width:45rem}.home-post-entry,.home-post-title{font-family:Roboto,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}.home-post-entry{background:#fff;padding:16px;box-sizing:border-box;width:100%;border-radius:2px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);font-size:.875rem;font-weight:400;letter-spacing:.04em;line-height:1.25rem}.home-post-entry+.home-post-entry{margin-top:16px}.home-post-title{display:inline;padding-right:4px;font-size:1.5rem;letter-spacing:normal;line-height:2rem;margin:-.5rem 0 1rem -.06em;font-weight:700}.footer-copyright a,.home-post-title>a{text-decoration:none;color:#009688}.home-post-title>a:hover,.home-post-title>a:visited{color:#009688}.home-post-meta{display:inline-block;margin-bottom:0}.home-post-excerpt{margin:8px 0 0;color:rgba(0,0,0,.87);font-family:Roboto,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-weight:400;line-height:1.25rem;font-size:1rem;letter-spacing:normal}.home-post-bottom{display:flex;flex-flow:row;padding-top:16px}.home-pagination{display:flex;flex-flow:row nowrap;padding:16px 8px;box-sizing:border-box;margin:0 auto;width:100%;max-width:45rem}.home-page-previous{margin-right:auto}.home-page-next{margin-left:auto}.footer,.footer-contents{display:flex;flex-shrink:0;box-sizing:border-box;width:100%}.footer{background-color:#009688;color:#fff;z-index:2;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);flex-flow:column nowrap;padding:16px}.footer-contents{position:relative;flex-flow:row nowrap;justify-content:center;align-items:center;margin:0 auto;padding:0 24px;max-width:45rem}@media (max-width:600px){.footer-contents{flex-wrap:wrap;padding:0}}.footer-avatar{border-radius:10%;width:100px;height:100px;background:#000;flex-grow:0;flex-shrink:0;margin-right:16px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.footer-text{flex-grow:1;flex-shrink:1;padding:16px;width:50%}.footer-heading{font-family:Roboto,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-size:1.25rem;font-weight:500;letter-spacing:.02em;line-height:2rem;margin:-.5rem 0 1rem -.05em;margin-bottom:8px}.footer-description{margin:0}.footer-icons,.footer-icons-row{display:block;flex-shrink:0}@media (max-width:600px){.footer-icons-row{display:inline-block}}.footer-bubble{display:inline-block;border-radius:50%;height:40px;width:40px;flex-shrink:0;margin:2px;background-repeat:no-repeat;background-size:contain;background-position:center}.footer-twitter{background-image:url(/assets/images/twitter.svg)}.footer-github{border-radius:0;background-image:url(/assets/images/github.svg)}.footer-email{background-image:url(/assets/images/email.svg)}.footer-feed{background-image:url(/assets/images/feed.svg)}.footer-bottom{display:flex;position:relative;justify-content:center;margin:8px auto 0;flex-shrink:0;width:100%;max-width:45rem}.footer-bottom::before{display:block;position:absolute;top:50%;width:100%;height:1px;background:rgba(255,255,255,.17);content:''}.footer-copyright{display:inline-block;text-align:center;background:#009688;z-index:2;padding:0 8px;font-family:Roboto,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-size:.75rem;font-weight:400;letter-spacing:.08em;line-height:1.25rem}.footer-copyright a{color:#fff;font-weight:700}.footer-copyright a:hover,.footer-copyright a:visited{color:#fff}.highlight,.post-content .highlight code{background:#f5f5f5;color:rgba(0,0,0,.87)}.highlight .c,.post-content .highlight code .c{color:#616161}.highlight .err,.post-content .highlight code .err{color:#f5f5f5;background-color:#b71c1c}.highlight .k,.post-content .highlight code .k{color:#4a148c}.highlight .cm,.post-content .highlight code .cm{color:#616161}.highlight .cp,.post-content .highlight code .cp{color:#4a148c}.highlight .c1,.post-content .highlight code .c1{color:#616161}.highlight .cs,.post-content .highlight code .cs{color:#4a148c}.highlight .gd,.post-content .highlight code .gd{color:#b71c1c}.highlight .ge,.post-content .highlight code .ge{font-style:italic}.highlight .gr,.post-content .highlight code .gr{color:#f5f5f5;background-color:#b71c1c}.highlight .gh,.post-content .highlight code .gh{color:#b71c1c}.highlight .gi,.post-content .highlight code .gi{color:#1b5e20}.highlight .gs,.post-content .highlight code .gs{font-weight:700}.highlight .gu,.post-content .highlight code .gu{color:#b71c1c}.highlight .kt,.post-content .highlight code .kt{color:#fbc02d}.highlight .m,.post-content .highlight code .m{color:#e65100}.highlight .s,.post-content .highlight code .s{color:#1b5e20}.highlight .na,.post-content .highlight code .na{color:#e65100}.highlight .nb,.post-content .highlight code .nb{color:#4a148c}.highlight .nc,.post-content .highlight code .nc{color:#fbc02d}.highlight .no,.post-content .highlight code .no{color:#e65100}.highlight .ni,.post-content .highlight code .ni{color:#1b5e20}.highlight .nf,.post-content .highlight code .nf{color:#0d47a1}.highlight .nt,.highlight .nv,.post-content .highlight code .nt,.post-content .highlight code .nv{color:#b71c1c}.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo,.post-content .highlight code .mf,.post-content .highlight code .mh,.post-content .highlight code .mi,.post-content .highlight code .mo{color:#e65100}.highlight .s2,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .se,.highlight .sh,.post-content .highlight code .s2,.post-content .highlight code .sb,.post-content .highlight code .sc,.post-content .highlight code .sd,.post-content .highlight code .se,.post-content .highlight code .sh{color:#1b5e20}.highlight .si,.post-content .highlight code .si{color:#3e2723}.highlight .sx,.post-content .highlight code .sx{color:#1b5e20}.highlight .sr,.post-content .highlight code .sr{color:#006064}.highlight .s1,.highlight .ss,.post-content .highlight code .s1,.post-content .highlight code .ss{color:#1b5e20}.highlight .bp,.post-content .highlight code .bp{color:#4a148c}.highlight .il,.post-content .highlight code .il{color:#e65100}body,html{display:flex;flex-direction:column;margin:0;padding:0;height:100%}.site-content{flex-grow:1;background:#eceff1}.mdc-button{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;text-decoration:none}
  </style>


  <!-- development -->

  
</head>


  <body>

    <header class="header" role="banner">
<div>
  <a class="header-title" href="/">sgom.es</a>
  <!-- No, I'm not Spanish. I just like short domain names. -->
</div>
</header>


    <main class="site-content" aria-label="Content">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Using Sass to automatically pick text colors</h1>
    <time class="post-meta" datetime="2016-12-21T16:51:00+00:00" itemprop="datePublished">(2016-12-21)</time>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><em>Originally <a href="https://medium.com/dev-channel/using-sass-to-automatically-pick-text-colors-4ba7645d2796">posted on Medium</a></em></p>

<p>Theming is always a challenge, particularly when you’re working on a library, rather than a standalone website. One example of an interesting issue that you’ll come across very frequently is choosing a text color that ensures readability and accessibility.</p>

<p><img class="post-image" src="/assets/posts/2016-12-21-using-sass-to-automatically-pick-text-colors/light-dark.png" alt="Dark text on light background and vice-versa" width="558" /></p>

<p>This is easy enough when you have known light or dark backgrounds; you can create two CSS classes and have users of your CSS library manually add them in depending on context.</p>

<p>Jekyll also offers powerful support for code snippets:</p>

<div class="language-css highlighter-rouge"><pre class="highlight"><code><span class="nt">dark-background-contrast</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">light-background-contrast</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">black</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>However, things become a bit trickier if you want to add the concept of a <strong>theme color</strong> to your library, and make it easy to use. This color will very often be used as a background, and will need sufficient contrast for the text that’s placed on top.</p>

<div class="language-css highlighter-rouge"><pre class="highlight"><code><span class="nt">theme-color-bg</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#3f51b5</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">theme-color-bg-contrast</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>In the example above, <code class="highlighter-rouge">theme-color-bg-contrast</code> needs to change to a <code class="highlighter-rouge">black</code> text color if the user-defined theme color is light. While this is impossible to do in pure CSS (at least until the extremely useful <a href="https://drafts.csswg.org/css-color/">CSS Color Module 4</a> is widely available), it can be done in Sass!</p>

<h2 id="working-out-the-sass">Working out the Sass</h2>

<p>Here’s what the initial Sass should look like:</p>

<div class="language-scss highlighter-rouge"><pre class="highlight"><code><span class="nv">$theme-color</span><span class="p">:</span> <span class="mh">#3f51b5</span> <span class="o">!</span><span class="nb">default</span><span class="p">;</span>

<span class="nt">theme-color-bg</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="nv">$theme-color</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">theme-color-bg-contrast</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="nf">choose-contrast-color</span><span class="p">(</span><span class="nv">$theme-color</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Users can override the <code class="highlighter-rouge">$theme-color</code>, and depending on what they pick, the <code class="highlighter-rouge">choose-contrast-color</code> function will return either <code class="highlighter-rouge">black</code> or <code class="highlighter-rouge">white</code>.</p>

<p>So how do we implement <code class="highlighter-rouge">choose-contrast-color</code>? It turns out that all of the necessary calculations and minimum contrast rules are well defined in the <a href="https://www.w3.org/TR/WCAG20/">WCAG 2.0 specification</a>. There’s a <a href="https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html">whole section explaining visual contrast in detail</a>, several links to ISO and ANSI standards, and even <a href="https://www.w3.org/Graphics/Color/sRGB.html">papers on the subject</a>. Digging around for a while, I was able to find a <a href="https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests">published W3C technique with a clear description of the algorithm</a>:</p>

<figure>
  <img class="post-image" src="/assets/posts/2016-12-21-using-sass-to-automatically-pick-text-colors/algorithm.png" alt="An excerpt of the algorithm for calculating color contrast" width="1606" />
  <figcaption>The algorithm for calculating color contrast</figcaption>
</figure>

<p>If you’re familiar with Sass, you’ll quickly notice an issue: the luminance calculations involve exponentiation, which isn’t available in the language or the standard library.</p>

<p>One solution to this would be to use the extensive <a href="http://compass-style.org/">Compass library</a>, which not only includes exponentiation, but also the luminance operations we’re trying to implement. It requires Ruby, however, so it’s not an option for <a href="https://github.com/sass/node-sass">node-sass</a> users. A pure Sass solution would be better.</p>

<h2 id="using-old-tricks">Using old tricks</h2>

<p>I was reviewing my math and exploring the possibility of using Newtonian approximation for the fractional parts of the exponent, until I had a chat with <a href="https://twitter.com/wibblymat">@wibblymat</a>, who happened to be implementing an emulator at the time. He suggested a much simpler, old-school approach: using a lookup table!</p>

<p>The only part that involves exponentiation is the per-channel color space conversions done as part of the luminance calculation. In addition, there are only 256 possible values for each channel. This means that we can easily create a lookup table.</p>

<figure>
  <img class="post-image" src="/assets/posts/2016-12-21-using-sass-to-automatically-pick-text-colors/lookup.png" alt="An excerpt of the lookup table" width="370" />
  <figcaption>An excerpt of the lookup table</figcaption>
</figure>

<p>You can take a look at <a href="https://github.com/material-components/material-components-web/blob/master/packages/mdc-theme/_constants.scss">the full table</a> that I generated for the <a href="https://github.com/material-components/material-components-web">MDC-Web project</a> to avoid having to generate your own.</p>

<p>With the channel values calculated, we can implement the rest of the algorithm easily:</p>

<div class="language-scss highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 * Calculate the luminance for a color.
 * See https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests
 */</span>
<span class="k">@function</span> <span class="nf">luminance</span><span class="p">(</span><span class="nv">$color</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$red</span><span class="p">:</span> <span class="nf">nth</span><span class="p">(</span><span class="nv">$linear-channel-values</span><span class="o">,</span> <span class="nf">red</span><span class="p">(</span><span class="nv">$color</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span><span class="p">);</span>
  <span class="nv">$green</span><span class="p">:</span> <span class="nf">nth</span><span class="p">(</span><span class="nv">$linear-channel-values</span><span class="o">,</span> <span class="nf">green</span><span class="p">(</span><span class="nv">$color</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span><span class="p">);</span>
  <span class="nv">$blue</span><span class="p">:</span> <span class="nf">nth</span><span class="p">(</span><span class="nv">$linear-channel-values</span><span class="o">,</span> <span class="nf">blue</span><span class="p">(</span><span class="nv">$color</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span><span class="p">);</span>

  <span class="k">@return</span> <span class="mi">.2126</span> <span class="o">*</span> <span class="nv">$red</span> <span class="o">+</span> <span class="mi">.7152</span> <span class="o">*</span> <span class="nv">$green</span> <span class="o">+</span> <span class="mi">.0722</span> <span class="o">*</span> <span class="nv">$blue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
 * Calculate the contrast ratio between two colors.
 * See https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests
 */</span>
<span class="k">@function</span> <span class="nf">contrast</span><span class="p">(</span><span class="nv">$back</span><span class="o">,</span> <span class="nv">$front</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$backLum</span><span class="p">:</span> <span class="nf">luminance</span><span class="p">(</span><span class="nv">$back</span><span class="p">)</span> <span class="o">+</span> <span class="mi">.05</span><span class="p">;</span>
  <span class="nv">$foreLum</span><span class="p">:</span> <span class="nf">luminance</span><span class="p">(</span><span class="nv">$front</span><span class="p">)</span> <span class="o">+</span> <span class="mi">.05</span><span class="p">;</span>

  <span class="k">@return</span> <span class="nf">max</span><span class="p">(</span><span class="nv">$backLum</span><span class="o">,</span> <span class="nv">$foreLum</span><span class="p">)</span> <span class="o">/</span> <span class="nf">min</span><span class="p">(</span><span class="nv">$backLum</span><span class="o">,</span> <span class="nv">$foreLum</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * Determine whether to use dark or light text on top of given color.
 * Returns black for dark text and white for light text.
 */</span>
<span class="k">@function</span> <span class="nf">choose-contrast-color</span><span class="p">(</span><span class="nv">$color</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$lightContrast</span><span class="p">:</span> <span class="nf">contrast</span><span class="p">(</span><span class="nv">$color</span><span class="o">,</span> <span class="no">white</span><span class="p">);</span>
  <span class="nv">$darkContrast</span><span class="p">:</span> <span class="nf">contrast</span><span class="p">(</span><span class="nv">$color</span><span class="o">,</span> <span class="no">black</span><span class="p">);</span>

  <span class="k">@if</span> <span class="p">(</span><span class="nv">$lightContrast</span> <span class="o">&gt;</span> <span class="nv">$darkContrast</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">@return</span> <span class="no">white</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">@else</span> <span class="p">{</span>
    <span class="k">@return</span> <span class="no">black</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>That’s it! We now have contrast calculation in Sass, and we’re automatically picking black or white text, depending on which provides the most contrast. This can have a huge impact on readability, particularly for users with low vision.</p>

<p>This solution only requires an extra, pre-calculated constants file that will never change. It works with any Sass implementation, and it won’t bloat your CSS since it’s only used at build time. Pretty neat!</p>

<p>Next time, I want to look at how to do the same thing in JavaScript, at runtime, so you can have dynamic theming with CSS custom properties. See you then!</p>

<p><strong>Edit</strong>: <a href="http://www.sassmeister.com/gist/ccc72f71137fe29039c92c0a9fe9b657">here’s a Sassmeister live demo</a> of the technique above.</p>

  </div>

  Tags:&nbsp;
  <div class="post-tags">
    
      sass
    
      theming
    
  </div>
</article>

    </main>

    <footer class="footer">
  <div class="footer-contents">
    <img class="footer-avatar" src="/assets/images/avatar.jpg" alt="Author's avatar">

    <div class="footer-text">
      <h2 class="footer-heading">Hey there!</h2>
      <p class="footer-description">I’m Sérgio, and I work at Web Developer Relations at Google, helping developers make the web a better place.
</p>
    </div>

    <div class="footer-icons">
      <div class="footer-icons-row">
        <a href="https://twitter.com/sergiomdgomes" class="footer-bubble footer-twitter"></a>
        <a href="mailto:mail@sgom.es" class="footer-bubble footer-email"></a>
      </div>
      <div class="footer-icons-row">
        <a href="/feed.xml" class="footer-bubble footer-feed"></a>
        <a href="https://github.com/sgomes" class="footer-bubble footer-github"></a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="footer-copyright">Articles under
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons 4.0 Attribution</a>,
    code under <a rel="license" href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a>
    (unless otherwise indicated).</div>
  </div>
</footer>


  </body>

</html>
